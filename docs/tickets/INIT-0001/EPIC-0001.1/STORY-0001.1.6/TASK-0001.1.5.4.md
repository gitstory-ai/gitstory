# TASK-0001.1.5.4: Write plugin development and troubleshooting guides, validate cross-references

**Parent Story**: [STORY-0001.1.5](README.md)
**Status**: ðŸ”µ Not Started
**Estimated Hours**: 5
**Actual Hours**: -

## Objective

Write final 2 documentation guides (plugin-development.md â‰¥400 words, troubleshooting.md â‰¥300 words), validate all cross-references work correctly, and verify documentation completeness. Integration task that completes all remaining BDD scenarios.

## BDD Progress

**Before this task**: 6/8 scenarios passing
**After this task**: 8/8 scenarios passing âœ…

**Scenarios for this task:**

- Scenario 5: Plugin development guide documents skill architecture (FULL)
- Scenario 6: Troubleshooting guide helps resolve common issues (FULL)
- Scenario 7: Documentation cross-references work correctly (COMPLETE - full validation)
- Scenario 8: Documentation examples validate syntactically (COMPLETE - all examples)

## Implementation Checklist

### Write plugin-development.md

- [ ] Create `skills/gitstory/references/plugin-development.md`:
  ```markdown
  # Plugin Development Guide

  **GitStory uses Claude Code's skill system for extensibility and custom workflows.**

  ## Skill Architecture

  **GitStory is implemented as a Claude Code skill with three core components:**

  1. **SKILL.md** - Skill manifest and processor instructions
  2. **Templates** - Ticket structure definitions (YAML frontmatter + markdown)
  3. **Commands** - Workflow automation (triggers, variables, steps)

  ## Directory Structure

  ```
  skills/gitstory/
  â”œâ”€â”€ SKILL.md              # Skill manifest and processor
  â”œâ”€â”€ config.json           # Marketplace configuration
  â”œâ”€â”€ templates/            # Ticket templates
  â”‚   â”œâ”€â”€ init.md          # Initiative template
  â”‚   â”œâ”€â”€ epic.md          # Epic template
  â”‚   â”œâ”€â”€ story.md         # Story template
  â”‚   â”œâ”€â”€ task.md          # Task template
  â”‚   â”œâ”€â”€ bug.md           # Bug template
  â”‚   â””â”€â”€ custom.md        # Custom template
  â”œâ”€â”€ commands/             # Command configurations
  â”‚   â”œâ”€â”€ plan.yaml        # Planning workflows
  â”‚   â”œâ”€â”€ review.yaml      # Quality review
  â”‚   â””â”€â”€ install.yaml     # Installation
  â””â”€â”€ references/           # Documentation guides
      â”œâ”€â”€ workflow-schema.md
      â”œâ”€â”€ template-authoring.md
      â”œâ”€â”€ command-authoring.md
      â”œâ”€â”€ plugin-development.md
      â””â”€â”€ troubleshooting.md
  ```

  ## SKILL.md Structure

  **The SKILL.md file defines how Claude Code processes GitStory commands:**

  ```markdown
  # GitStory - Story-Driven Development for Claude Code

  **Skill Version**: 1.0.0

  ## Trigger Patterns

  This skill activates when user input matches:
  - `/gitstory:*` slash commands
  - Ticket ID references (INIT-*, EPIC-*, STORY-*, TASK-*)
  - Planning keywords ("create ticket", "plan story")

  ## Command Processing

  1. Parse user input against trigger patterns
  2. Load command configuration from commands/
  3. Extract variables from context (ticket_id, branch_name, etc.)
  4. Execute command steps sequentially
  5. Substitute variables in response template
  6. Return formatted response to user

  ## Template System Integration

  Commands can reference templates via `load_template` action:
  - Loads from 3-tier priority (project â†’ user â†’ skill)
  - Parses YAML frontmatter for field definitions
  - Substitutes variables in template content
  - Returns rendered ticket content
  ```

  ## Creating Custom Commands

  **Add new commands by creating YAML files in `.gitstory/commands/`:**

  ```yaml
  name: "Custom Workflow"
  description: "Your custom command description"
  version: "1.0.0"

  triggers:
    - type: "keyword"
      value: "custom workflow"
      case_insensitive: true

  variables:
    - name: "custom_var"
      source: "conversation"

  steps:
    - action: "custom_action"
      input: "{custom_var}"
      description: "Your custom step"
      output: "result"

  response_template: |
    Custom workflow result: {result}
  ```

  **Override default commands by placing YAML in project root:**
  - `.gitstory/commands/plan.yaml` overrides default plan command
  - Retains access to all built-in actions and variables

  ## Creating Custom Templates

  **Add new templates by creating markdown files in `.gitstory/templates/`:**

  ```markdown
  ---
  name: "Feature Request Template"
  description: "Template for feature requests"
  version: "1.0.0"
  fields:
    - name: "priority"
      type: "select"
      required: true
      validation: "High,Medium,Low"
    - name: "business_value"
      type: "textarea"
      required: true
  ---

  # FEATURE-{ticket_id}: {title}

  **Priority**: {priority}
  **Status**: {status}

  ## Business Value

  {business_value}
  ```

  **Override default templates:**
  - `.gitstory/templates/story.md` overrides default story template
  - All field validation and substitution still works

  ## Extending with Custom Actions

  **To add custom step actions, modify SKILL.md:**

  ```markdown
  ## Custom Actions

  ### validate_dependencies
  Check if all prerequisite tasks are complete before starting.

  **Input**: ticket_id
  **Output**: validation_status (true/false)

  ### calculate_velocity
  Calculate team velocity from completed story points.

  **Input**: time_range (days)
  **Output**: velocity (points per day)
  ```

  ## API Reference

  **Variable Sources:**
  - `trigger_match` - Extract from regex capture groups
  - `git` - Execute git command and capture output
  - `conversation` - Get user input from message context
  - `git_command` - Execute arbitrary git command
  - `template` - Reference template field values

  **Step Actions:**
  - `extract_ticket` - Load ticket README from docs/tickets/
  - `load_template` - Load template from templates/ with priority
  - `interview_user` - Interactive Q&A for requirements
  - `generate_tasks` - Create task breakdown from story
  - `update_ticket` - Modify ticket README content
  - `validate_specification` - Quality check ticket content
  - `score_quality` - Calculate 0-100% quality score

  ## Testing Custom Plugins

  **Use BDD scenarios to test custom commands:**

  ```gherkin
  Scenario: Custom workflow command executes correctly
    Given I have a custom command in .gitstory/commands/custom.yaml
    When I trigger the command with "custom workflow STORY-0001.1.1"
    Then the command loads the story ticket
    And custom_action executes with extracted ticket_id
    And response includes "Custom workflow result"
  ```

  ## Best Practices

  1. **Start with overrides** - Copy default templates/commands and modify
  2. **Test with real tickets** - Validate commands with actual ticket creation
  3. **Document custom actions** - Add clear descriptions in SKILL.md
  4. **Use validation** - Define field validation in templates
  5. **Follow naming conventions** - Match existing patterns for consistency

  ## Example: Custom Sprint Command

  ```yaml
  name: "Start Sprint"
  description: "Initialize sprint with selected stories"
  version: "1.0.0"

  triggers:
    - type: "keyword"
      value: "start sprint"

  variables:
    - name: "sprint_number"
      source: "conversation"
    - name: "story_ids"
      source: "conversation"

  steps:
    - action: "validate_stories"
      input: "{story_ids}"
      description: "Check all stories are ready"
      output: "validation_result"

    - action: "create_sprint_branch"
      input: "sprint-{sprint_number}"
      description: "Create sprint branch"
      output: "branch_name"

    - action: "update_stories"
      input: "{story_ids}, {branch_name}"
      description: "Update story statuses to In Progress"

  response_template: |
    Sprint {sprint_number} started!
    Branch: {branch_name}
    Stories: {story_ids}
  ```

  ## References

  - Template authoring: {baseDir}/template-authoring.md
  - Command authoring: {baseDir}/command-authoring.md
  - Workflow schema: {baseDir}/workflow-schema.md
  ```
- [ ] Validate word count â‰¥400 words
- [ ] Validate all code examples are complete and valid

### Write troubleshooting.md

- [ ] Create `skills/gitstory/references/troubleshooting.md`:
  ```markdown
  # Troubleshooting Guide

  **Common issues and solutions for GitStory skill.**

  ## Installation Issues

  ### Skill not recognized

  **Symptom**: `/gitstory:*` commands not recognized by Claude Code

  **Cause**: Skill not installed or not in skill directory

  **Solution**:
  ```bash
  # Check if skill directory exists
  ls ~/.claude/skills/gitstory/

  # If missing, install skill
  /gitstory:install

  # Verify SKILL.md exists
  cat ~/.claude/skills/gitstory/SKILL.md
  ```

  ### Config.json validation errors

  **Symptom**: Skill loads but commands fail with "invalid config"

  **Cause**: Malformed JSON in config.json

  **Solution**:
  ```bash
  # Validate JSON syntax
  python3 -c "import json; json.load(open('skills/gitstory/config.json'))"

  # Check required fields
  # Required: name, version, description, triggers
  ```

  ## Template Issues

  ### Template not found

  **Symptom**: "Template 'story' not found" error

  **Cause**: Template missing or incorrect file path

  **Solution**:
  ```bash
  # Check template exists in any priority level
  ls .gitstory/templates/story.md           # Project override
  ls ~/.claude/skills/gitstory/templates/story.md  # User override
  ls skills/gitstory/templates/story.md     # Skill default

  # Create project override if needed
  mkdir -p .gitstory/templates
  cp skills/gitstory/templates/story.md .gitstory/templates/
  ```

  ### YAML frontmatter parsing errors

  **Symptom**: "YAML parsing failed: line X" error

  **Cause**: Invalid YAML syntax in template frontmatter

  **Solution**:
  ```bash
  # Validate YAML syntax
  python3 -c "
  import yaml
  with open('.gitstory/templates/story.md') as f:
      content = f.read()
      parts = content.split('---')
      yaml.safe_load(parts[1])
  "

  # Common issues:
  # - Missing closing --- delimiter
  # - Incorrect indentation (use 2 or 4 spaces)
  # - Unquoted values with special characters
  ```

  ### Field validation failures

  **Symptom**: "Field 'story_points' validation failed"

  **Cause**: Value doesn't match validation pattern

  **Solution**:
  - Check allowed values: `validation: "1,2,3,5,8,13"`
  - Check numeric range: `validation: "min:1,max:100"`
  - Check regex pattern: `validation: "regex:^[A-Z]"`

  ## Command Issues

  ### Trigger not matching

  **Symptom**: Command doesn't activate when expected

  **Cause**: Trigger pattern doesn't match user input

  **Diagnostics**:
  ```bash
  # Test regex pattern
  python3 -c "
  import re
  pattern = r'^/gitstory:plan\\s+STORY-\\d{4}\\.\\d+\\.\\d+$'
  test = '/gisstory:plan STORY-0001.1.1'
  print(re.match(pattern, test))
  "
  ```

  **Solution**:
  - Check pattern escaping (use `\\s` not `\s` in YAML)
  - Test with exact command format
  - Try keyword trigger as fallback

  ### Variable substitution not working

  **Symptom**: `{variable_name}` appears literally in output

  **Cause**: Variable not defined or source not providing value

  **Diagnostics**:
  ```bash
  # Check git command variables
  git rev-parse --abbrev-ref HEAD  # Should return current branch

  # Check if variable defined in command YAML
  grep "name: \"variable_name\"" .gitstory/commands/plan.yaml
  ```

  **Solution**:
  - Ensure variable defined in `variables:` section
  - Check source type matches data source
  - Add logging to see variable resolution

  ### Command not found in lookup priority

  **Symptom**: "Command 'plan' not found" error

  **Cause**: Missing YAML file at all priority levels

  **Solution**:
  ```bash
  # Check all three levels
  ls .gitstory/commands/plan.yaml            # Project (highest)
  ls ~/.claude/skills/gitstory/commands/plan.yaml  # User
  ls skills/gitstory/commands/plan.yaml      # Skill (lowest)

  # Copy from default if needed
  mkdir -p .gitstory/commands
  cp skills/gitstory/commands/plan.yaml .gitstory/commands/
  ```

  ## Documentation Issues

  ### Broken cross-references

  **Symptom**: Links don't work or show 404

  **Cause**: Incorrect {baseDir} substitution or wrong path

  **Solution**:
  - Use `{baseDir}` for skill-relative paths
  - Use `{baseDir}/../../docs/` for docs/ paths
  - Validate with documentation validator

  ### YAML examples don't parse

  **Symptom**: Copy-pasted YAML from docs fails validation

  **Cause**: Markdown rendering added/removed characters

  **Solution**:
  ```bash
  # Validate YAML from raw markdown
  python3 -c "
  import yaml, re
  content = open('skills/gitstory/references/command-authoring.md').read()
  yaml_blocks = re.findall(r'\`\`\`yaml\n(.*?)\n\`\`\`', content, re.DOTALL)
  for i, block in enumerate(yaml_blocks):
      yaml.safe_load(block)
      print(f'Block {i+1}: valid')
  "
  ```

  ## Getting Help

  **If issues persist:**

  1. Check skill version: `cat skills/gitstory/SKILL.md | grep "Version"`
  2. Review error logs in Claude Code console
  3. Validate all YAML files with Python yaml.safe_load()
  4. Check file permissions on .gitstory/ directories
  5. Try `/gitstory:install` to reset skill configuration

  **Common diagnostic commands:**
  ```bash
  # Validate all templates
  find skills/gitstory/templates -name "*.md" -exec python3 -c "import yaml; yaml.safe_load(open('{}').read().split('---')[1])" \;

  # Validate all commands
  find skills/gitstory/commands -name "*.yaml" -exec python3 -c "import yaml; yaml.safe_load(open('{}'))" \;

  # Check ticket structure
  find docs/tickets -type f -name "README.md" | head -5
  ```

  ## References

  - Plugin development: {baseDir}/plugin-development.md
  - Template authoring: {baseDir}/template-authoring.md
  - Command authoring: {baseDir}/command-authoring.md
  ```
- [ ] Validate word count â‰¥300 words
- [ ] Validate all diagnostic commands are runnable

### Validate All Documentation Cross-References

- [ ] Run documentation validator on all 5 guides:
  ```bash
  python3 -c "
  from src.gitstory.documentation.validator import DocumentationValidator
  from pathlib import Path

  validator = DocumentationValidator(Path('skills/gitstory'))
  guides = [
      'workflow-schema.md',
      'template-authoring.md',
      'command-authoring.md',
      'plugin-development.md',
      'troubleshooting.md'
  ]

  for guide in guides:
      path = Path(f'skills/gitstory/references/{guide}')
      errors = validator.validate_markdown(path)
      if errors:
          print(f'{guide}: {errors}')
      else:
          print(f'{guide}: valid âœ“')
  "
  ```
- [ ] Fix any broken cross-references detected
- [ ] Validate all {baseDir} links resolve correctly
- [ ] Ensure no header hierarchy violations

### BDD Implementation (Scenarios 5, 6, 7 complete, 8 complete)

- [ ] Implement step: "Given skills/gitstory/references/plugin-development.md"
- [ ] Implement step: "When I review plugin development guide"
- [ ] Implement step: "Then it documents skill architecture (SKILL.md, templates, commands)"
- [ ] Implement step: "And plugin-development.md is â‰¥400 words"
- [ ] Implement step: "And it includes API reference for actions and variables"
- [ ] Implement step: "Given skills/gitstory/references/troubleshooting.md"
- [ ] Implement step: "When I review troubleshooting guide"
- [ ] Implement step: "Then it documents common issues (installation, templates, commands)"
- [ ] Implement step: "And troubleshooting.md is â‰¥300 words"
- [ ] Implement step: "And it includes diagnostic commands for each issue"
- [ ] Implement step: "Given all documentation files with cross-references"
- [ ] Implement step: "When validating all {baseDir} links"
- [ ] Implement step: "Then ALL links resolve to existing files correctly"
- [ ] Implement step: "And no broken links detected"
- [ ] Implement step: "Given all documentation with code examples"
- [ ] Implement step: "When validating ALL YAML and markdown examples"
- [ ] Implement step: "Then ALL examples validate syntactically"
- [ ] Run BDD tests - ALL 8 scenarios pass âœ…

### Verification

- [ ] All 5 documentation guides created
- [ ] Word count requirements met (all guides)
- [ ] All cross-references validate correctly
- [ ] All code examples validate syntactically
- [ ] BDD Scenarios 5-8 complete, ALL 8/8 scenarios passing âœ…
- [ ] All acceptance criteria verified

## Files to Create/Modify

- CREATE: `skills/gitstory/references/plugin-development.md` (~600 words, skill architecture)
- CREATE: `skills/gitstory/references/troubleshooting.md` (~500 words, issue diagnostics)
- MODIFY: `tests/e2e/steps/test_documentation.py` (implement steps for Scenarios 5, 6, 7 complete, 8 complete)
- MODIFY: `docs/tickets/INIT-0001/EPIC-0001.1/STORY-0001.1.5/README.md` (update progress to 100%)

## Pattern Reuse

- `Troubleshooting guide format` (from other projects) - Issue â†’ Cause â†’ Diagnostics â†’ Solution pattern
- `API reference documentation` (standard format) - Clear parameter and return value documentation

## Integration Points

### With SKILL.md (STORY-0001.1.2)

Plugin development guide documents how SKILL.md processes commands and integrates with templates.

### With Templates (STORY-0001.1.3)

Troubleshooting guide includes template validation and debugging procedures.

### With Commands (STORY-0001.1.4)

Troubleshooting guide includes command trigger debugging and variable diagnostics.

## Edge Cases Handled

- Missing skill directory (installation troubleshooting)
- Permission errors on .gitstory/ (diagnostic commands)
- YAML syntax errors (validation troubleshooting)
- Broken links in documentation (cross-reference validation)
- Invalid regex patterns (trigger debugging)

## Success Criteria

- [ ] All 8 BDD scenarios passing âœ…
- [ ] All 5 documentation guides created
- [ ] Word count requirements met
- [ ] All cross-references validate
- [ ] All examples validate syntactically
- [ ] All acceptance criteria verified
- [ ] Story marked 100% complete
