# TASK-0001.1.1.4: Implement example YAML validator with TDD

**Parent Story**: [STORY-0001.1.1](README.md)
**Status**: ✅ Complete
**Estimated Hours**: 4
**Actual Hours**: 1

## Objective

Implement a YAML syntax validator (`src/gitstory/validators/yaml_validator.py`) with comprehensive unit tests following TDD (Test-Driven Development). This demonstrates the testing pattern for future Python scripts and validates the test infrastructure works correctly.

## Implementation Checklist

### Unit Tests First (TDD - RED Phase)

- [x] Create `tests/validators/` directory
- [x] Create `tests/validators/__init__.py`
- [x] Create `tests/validators/test_yaml_validator.py`
- [x] Write failing test: `test_valid_yaml()` - Valid YAML should pass validation
  - [x] Test content: `"key: value\nlist:\n  - item1\n  - item2"`
  - [x] Assert `validate_yaml(content) is True`
- [x] Write failing test: `test_invalid_yaml()` - Invalid YAML should fail validation
  - [x] Test content: `"key: value\n  bad indentation\nno_colon_or_dash"`
  - [x] Assert `validate_yaml(content) is False`
- [x] Write failing test: `test_empty_yaml()` - Empty content should be valid
  - [x] Assert `validate_yaml("") is True`
- [x] Write failing test: `test_yaml_with_unicode()` - Unicode should work
  - [x] Test content with emoji/unicode characters
  - [x] Assert `validate_yaml(content) is True`
- [x] Write failing test: `test_validate_yaml_file_success()` - File validation happy path
  - [x] Use temp file with valid YAML
  - [x] Assert `validate_yaml_file(filepath) is True`
- [x] Write failing test: `test_validate_yaml_file_invalid()` - File validation with invalid YAML
  - [x] Use temp file with invalid YAML
  - [x] Assert result is error string containing filename
- [x] Write failing test: `test_validate_yaml_file_not_found()` - File not found error
  - [x] Assert result is "File not found: {path}"
- [x] Run tests: `uv run pytest tests/validators/test_yaml_validator.py -v`
- [x] Verify all 7+ tests fail with ImportError or ModuleNotFoundError ✓

### Implementation (GREEN Phase)

- [x] Create `src/gitstory/validators/yaml_validator.py`
- [x] Add module docstring: "YAML syntax validation for GitStory config files."
- [x] Import dependencies: `import yaml`
- [x] Implement `validate_yaml(content: str) -> bool`:
  - [x] Handle empty string case (return True)
  - [x] Try `yaml.safe_load(content)`
  - [x] Catch `yaml.YAMLError` and return False
  - [x] Return True if parsing succeeds
  - [x] Add type hints and docstring (Args, Returns)
- [x] Implement `validate_yaml_file(filepath: str) -> bool | str`:
  - [x] Try to open and read file
  - [x] Call `validate_yaml(content)`
  - [x] Return True if valid
  - [x] Return error string if invalid: `f"Invalid YAML syntax in {filepath}"`
  - [x] Handle FileNotFoundError: return `f"File not found: {filepath}"`
  - [x] Handle other exceptions: return `f"Error reading {filepath}: {str(e)}"`
  - [x] Add type hints and docstring
- [x] Run tests: `uv run pytest tests/validators/test_yaml_validator.py -v`
- [x] Verify all tests pass ✓

### Refactor Phase (CLEAN)

- [x] Review code for clarity and simplicity
- [x] Check docstrings are complete and accurate
- [x] Verify type hints are correct (using modern `X | Y` syntax)
- [x] Ensure consistent error message format
- [x] Run tests again - all still pass ✓

### Quality Gates

- [x] Run linting: `uv run ruff check src tests`
  - [x] Fix any issues reported (auto-fixed with --fix)
- [x] Run formatting: `uv run ruff format src tests`
  - [x] Accept formatting changes
- [x] Run type checking: `uv run mypy src`
  - [x] No type errors
- [x] Run tests with coverage: `uv run pytest --cov=src/gitstory/validators`
  - [x] Achieved 90% coverage for validators module (exceeded goal)
- [x] Run all tests: `uv run pytest -v`
  - [x] All 7 tests pass

## Files to Create/Modify

- CREATE: `src/gitstory/validators/yaml_validator.py` (~60 lines, validator implementation)
- CREATE: `tests/validators/__init__.py` (empty module marker)
- CREATE: `tests/validators/test_yaml_validator.py` (~120 lines, comprehensive unit tests)

## Implementation Reference

See story README Technical Design section (lines 205-258) for complete validator implementation example. Use as reference for expected functionality.

## Testing Approach

**TDD (Test-Driven Development)**:
1. **RED**: Write failing tests first (7+ test cases)
2. **GREEN**: Implement minimal code to pass tests
3. **REFACTOR**: Clean up code while keeping tests green

## Notes

- Follow TDD strictly: tests before implementation
- This validator will be used in later stories for YAML config validation
- Example demonstrates the testing pattern for future scripts
- Coverage should be >90% for this module (it's simple and fully testable)
- Use `yaml.safe_load()` (not `yaml.load()`) for security

## Success Criteria

- [x] All 7+ unit tests pass
- [x] Code coverage >90% for validators module (achieved 90%)
- [x] All quality gates pass (ruff, mypy, pytest)
- [x] Validator correctly validates YAML syntax
- [x] File validation handles errors gracefully
- [x] TDD pattern demonstrated (tests written before implementation)
- [x] Ready for TASK-0001.1.1.5 (README creation)
