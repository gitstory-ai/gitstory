# TASK-0001.1.1.4: Implement example YAML validator with TDD

**Parent Story**: [STORY-0001.1.1](README.md)
**Status**: ðŸ”µ Not Started
**Estimated Hours**: 4
**Actual Hours**: -

## Objective

Implement a YAML syntax validator (`src/gitstory/validators/yaml_validator.py`) with comprehensive unit tests following TDD (Test-Driven Development). This demonstrates the testing pattern for future Python scripts and validates the test infrastructure works correctly.

## Implementation Checklist

### Unit Tests First (TDD - RED Phase)

- [ ] Create `tests/validators/` directory
- [ ] Create `tests/validators/__init__.py`
- [ ] Create `tests/validators/test_yaml_validator.py`
- [ ] Write failing test: `test_valid_yaml()` - Valid YAML should pass validation
  - [ ] Test content: `"key: value\nlist:\n  - item1\n  - item2"`
  - [ ] Assert `validate_yaml(content) is True`
- [ ] Write failing test: `test_invalid_yaml()` - Invalid YAML should fail validation
  - [ ] Test content: `"key: value\ninvalid:\n  - item1\n    - nested_wrong"`
  - [ ] Assert `validate_yaml(content) is False`
- [ ] Write failing test: `test_empty_yaml()` - Empty content should be valid
  - [ ] Assert `validate_yaml("") is True`
- [ ] Write failing test: `test_yaml_with_unicode()` - Unicode should work
  - [ ] Test content with emoji/unicode characters
  - [ ] Assert `validate_yaml(content) is True`
- [ ] Write failing test: `test_validate_yaml_file_success()` - File validation happy path
  - [ ] Use temp file with valid YAML
  - [ ] Assert `validate_yaml_file(filepath) is True`
- [ ] Write failing test: `test_validate_yaml_file_invalid()` - File validation with invalid YAML
  - [ ] Use temp file with invalid YAML
  - [ ] Assert result is error string containing filename
- [ ] Write failing test: `test_validate_yaml_file_not_found()` - File not found error
  - [ ] Assert result is "File not found: {path}"
- [ ] Run tests: `uv run pytest tests/validators/test_yaml_validator.py -v`
- [ ] Verify all 7+ tests fail with ImportError or ModuleNotFoundError âœ“

### Implementation (GREEN Phase)

- [ ] Create `src/gitstory/validators/yaml_validator.py`
- [ ] Add module docstring: "YAML syntax validation for GitStory config files."
- [ ] Import dependencies: `import yaml`, `from typing import Union`
- [ ] Implement `validate_yaml(content: str) -> bool`:
  - [ ] Handle empty string case (return True)
  - [ ] Try `yaml.safe_load(content)`
  - [ ] Catch `yaml.YAMLError` and return False
  - [ ] Return True if parsing succeeds
  - [ ] Add type hints and docstring (Args, Returns)
- [ ] Implement `validate_yaml_file(filepath: str) -> Union[bool, str]`:
  - [ ] Try to open and read file
  - [ ] Call `validate_yaml(content)`
  - [ ] Return True if valid
  - [ ] Return error string if invalid: `f"Invalid YAML syntax in {filepath}"`
  - [ ] Handle FileNotFoundError: return `f"File not found: {filepath}"`
  - [ ] Handle other exceptions: return `f"Error reading {filepath}: {str(e)}"`
  - [ ] Add type hints and docstring
- [ ] Run tests: `uv run pytest tests/validators/test_yaml_validator.py -v`
- [ ] Verify all tests pass âœ“

### Refactor Phase (CLEAN)

- [ ] Review code for clarity and simplicity
- [ ] Check docstrings are complete and accurate
- [ ] Verify type hints are correct
- [ ] Ensure consistent error message format
- [ ] Run tests again - all still pass âœ“

### Quality Gates

- [ ] Run linting: `uv run ruff check src tests`
  - [ ] Fix any issues reported
- [ ] Run formatting: `uv run ruff format src tests`
  - [ ] Accept formatting changes
- [ ] Run type checking: `uv run mypy src`
  - [ ] Fix any type errors
- [ ] Run tests with coverage: `uv run pytest --cov=src/gitstory/validators`
  - [ ] Verify >90% coverage for validators module
- [ ] Run all tests: `uv run pytest -v`
  - [ ] All tests pass

## Files to Create/Modify

- CREATE: `src/gitstory/validators/yaml_validator.py` (~60 lines, validator implementation)
- CREATE: `tests/validators/__init__.py` (empty module marker)
- CREATE: `tests/validators/test_yaml_validator.py` (~120 lines, comprehensive unit tests)

## Implementation Reference

See story README Technical Design section (lines 205-258) for complete validator implementation example. Use as reference for expected functionality.

## Testing Approach

**TDD (Test-Driven Development)**:
1. **RED**: Write failing tests first (7+ test cases)
2. **GREEN**: Implement minimal code to pass tests
3. **REFACTOR**: Clean up code while keeping tests green

## Notes

- Follow TDD strictly: tests before implementation
- This validator will be used in later stories for YAML config validation
- Example demonstrates the testing pattern for future scripts
- Coverage should be >90% for this module (it's simple and fully testable)
- Use `yaml.safe_load()` (not `yaml.load()`) for security

## Success Criteria

- [ ] All 7+ unit tests pass
- [ ] Code coverage >90% for validators module
- [ ] All quality gates pass (ruff, mypy, pytest)
- [ ] Validator correctly validates YAML syntax
- [ ] File validation handles errors gracefully
- [ ] TDD pattern demonstrated (tests written before implementation)
- [ ] Ready for TASK-0001.1.1.5 (README creation)
