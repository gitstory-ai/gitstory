# TASK-0001.1.3.1: Create Typer App with Dual Output Modes

**Parent Story**: [STORY-0001.1.3](README.md)
**Status**: ðŸ”µ Not Started
**Estimated Hours**: 3
**Actual Hours**: -

## Objective

Create typer CLI application optimized for Claude Code invocation with dual output modes (rich for human presentation, JSON for programmatic parsing).

## Implementation Checklist

### Phase 1: Typer App Foundation (TDD - Write Tests First)

- [ ] Write unit test for typer app initialization (`tests/unit/cli/test_app.py`)
- [ ] Write unit test for --version flag
- [ ] Write unit test for --help flag
- [ ] Write unit test for --json global flag
- [ ] Run tests - all fail âœ“

### Phase 2: Implementation (GREEN)

- [ ] Create `src/gitstory/cli/__init__.py` with typer.Typer() app
- [ ] Add `--json` global flag using typer.Option()
- [ ] Implement version callback reading from `importlib.metadata.version("gitstory")`
- [ ] Create `src/gitstory/__main__.py` entry point that calls `cli.app()`
- [ ] Run tests - all pass âœ“

### Phase 3: Output Infrastructure

- [ ] Create `src/gitstory/cli/output.py` with OutputFormatter class
- [ ] Implement `render_rich(data)` method using rich.console.Console
- [ ] Implement `render_json(data)` method using json.dumps with indent=2
- [ ] Write unit tests for OutputFormatter (`tests/unit/cli/test_output.py`)
- [ ] Run tests - all pass âœ“

### Verification

- [ ] All unit tests pass
- [ ] `uvx gitstory --help` displays help text with rich formatting
- [ ] `uvx gitstory --version` displays version from pyproject.toml
- [ ] `uvx gitstory --json --help` outputs JSON format
- [ ] Entry point callable programmatically: `python -m gitstory --help` works
- [ ] Code coverage >90% for cli/__init__.py and cli/output.py

## Files to Create/Modify

- CREATE: `src/gitstory/cli/__init__.py` (~50 lines, typer app with global flags)
- CREATE: `src/gitstory/cli/output.py` (~80 lines, OutputFormatter class)
- MODIFY: `src/gitstory/__main__.py` (~10 lines, entry point implementation)
- CREATE: `tests/unit/cli/__init__.py` (empty)
- CREATE: `tests/unit/cli/test_app.py` (~60 lines, typer app tests)
- CREATE: `tests/unit/cli/test_output.py` (~50 lines, output formatter tests)

## Design Decisions

### Dual Output Philosophy

**Rich output (default):** For human presentation when Claude shows results to users
- Uses rich.console for colors, tables, progress bars
- Visually appealing, easy to read in terminal
- Example: `[green]âœ“[/green] Story created successfully`

**JSON output (--json flag):** For programmatic parsing by Claude
- Structured data Claude can parse and use in logic
- Consistent schema across all commands
- Example: `{"status": "success", "ticket_id": "STORY-0001.2.4", "message": "Story created"}`

### Entry Point Pattern

```python
# src/gitstory/__main__.py
from gitstory.cli import app

if __name__ == "__main__":
    app()
```

This allows both:
- `gitstory` command (via pyproject.toml entry point)
- `python -m gitstory` (direct module invocation)
- `import gitstory.cli; gitstory.cli.app()` (programmatic)

## Pattern Reuse

- `pytest` - Unit testing framework (already configured in STORY-0001.1.1)
- `typer` - CLI framework with built-in testing support
- `rich` - Terminal formatting (already dependency in STORY-0001.1.2)

## Dependencies

- STORY-0001.1.2 complete (CLI package structure exists)
- pyproject.toml dependencies: typer>=0.9, rich>=13.0, pydantic>=2.0

## Success Criteria

- âœ… Typer app initialized and tests pass
- âœ… --version and --help flags work correctly
- âœ… --json flag toggles output mode globally
- âœ… OutputFormatter supports both rich and JSON rendering
- âœ… Entry point works via `uvx`, `pipx`, and `python -m`
- âœ… Code coverage >90%
