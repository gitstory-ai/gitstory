# TASK-0001.1.2.2: Create .claude-plugin/config.json with validation

**Parent Story**: [STORY-0001.1.2](README.md)
**Status**: ðŸ”µ Not Started
**Estimated Hours**: 3
**Actual Hours**: -

## Objective

Create .claude-plugin/config.json file with 9 required fields and JSON validation system with unit tests. Implements foundation configuration and first BDD scenario.

## BDD Progress

**Before this task**: 0/3 scenarios passing
**After this task**: 1/3 scenarios passing

**Scenarios for this task:**

- Scenario 1: Marketplace config enables skill installation (FULL - implement all steps)

## Implementation Checklist

### Unit Tests First (TDD - RED)

- [ ] Create `tests/unit/test_config_validation.py`
- [ ] Write test for JSON syntax validation (5+ tests covering valid/invalid JSON)
- [ ] Write test for required field presence (9 fields: name, id, version, entry_point, author, description, keywords, license, repository)
- [ ] Write test for field types (keywords must be array, etc.)
- [ ] Write test for entry_point file existence check
- [ ] Run tests - all fail âœ“

### Implementation (GREEN)

- [ ] Create `.claude-plugin/` directory (if not exists)
- [ ] Create `.claude-plugin/config.json` with 9 required fields:
  ```json
  {
    "name": "gitstory",
    "id": "gitstory-ai/gitstory",
    "version": "0.1.0",
    "entry_point": "skills/gitstory/SKILL.md",
    "author": "Bram Swenson",
    "description": "Workflow-agnostic ticket management via plugin-based state machines",
    "keywords": ["workflow", "tickets", "state-machine", "planning", "BDD", "kanban", "scrum", "agile"],
    "license": "MIT",
    "repository": "https://github.com/gitstory-ai/gitstory"
  }
  ```
- [ ] Implement JSON schema validation function
- [ ] Implement field completeness check:
  ```bash
  for field in name id version entry_point author description keywords license repository; do
    jq -e ".$field" .claude-plugin/config.json > /dev/null || echo "ERROR: Missing field $field"
  done
  ```
- [ ] Validate with `python -m json.tool .claude-plugin/config.json`
- [ ] Run tests - all pass âœ“

### BDD Implementation (Scenario 1)

- [ ] Implement step: "Given .claude-plugin/config.json with skill metadata"
- [ ] Implement step: "When validated against anthropics/skills format"
- [ ] Implement step: "Then JSON syntax passes: python -m json.tool .claude-plugin/config.json"
- [ ] Implement step: "And all required fields present: name, id, version, entry_point, author, description, keywords, license, repository"
- [ ] Implement step: "And entry_point references skills/gitstory/SKILL.md"
- [ ] Run BDD tests - Scenario 1 passes, Scenarios 2-3 fail âœ“

### Verification

- [ ] All unit tests pass (100% coverage for validation logic)
- [ ] BDD Scenario 1 passes (1/3 passing)
- [ ] config.json is valid JSON (verified with json.tool)
- [ ] All 9 required fields present

## Files to Create/Modify

- CREATE: `.claude-plugin/config.json` (~20 lines, JSON structure)
- CREATE: `tests/unit/test_config_validation.py` (~100 lines, validation tests)
- MODIFY: `tests/e2e/steps/test_skill_scaffold.py` (implement 4-5 steps for Scenario 1)

## Pattern Reuse

- `json_schema_validation` (Standard library json.tool) - Validate JSON syntax and structure using `python -m json.tool .claude-plugin/config.json`

## Edge Cases Handled

- If .claude-plugin/ directory missing â†’ Create directory before writing config.json
- If config.json exists â†’ Fail with error message: 'config.json already exists at .claude-plugin/config.json. Delete or rename before regenerating.'
- If no write permission â†’ Display error with path and permission requirements, exit code 2

## Performance Targets

- JSON validation: <10ms
- Field completeness check: <5ms
