# TASK-0001.1.3.2: Create directory structure and YAML parser foundation

**Parent Story**: [STORY-0001.1.3](README.md)
**Status**: ðŸ”µ Not Started
**Estimated Hours**: 4
**Actual Hours**: -

## Objective

Create skills/gitstory/templates/ directory and implement YAML frontmatter parser with validation. Foundation task that implements core parsing infrastructure with comprehensive unit tests.

## BDD Progress

**Before this task**: 0/6 scenarios passing
**After this task**: 2/6 scenarios passing

**Scenarios for this task:**

- Scenario 1: Default templates available (FULL - verify directory structure)
- Scenario 6: Templates validate with Python YAML parser (FULL - parser implementation)

## Implementation Checklist

### Unit Tests First (TDD - RED)

- [ ] Create `tests/unit/templates/test_yaml_parser.py`
- [ ] Write test for parse_frontmatter() with valid YAML (2+ tests)
- [ ] Write test for parse_frontmatter() with invalid YAML (2+ tests)
- [ ] Write test for parse_frontmatter() with missing delimiters (1 test)
- [ ] Write test for parse_frontmatter() with empty frontmatter (1 test)
- [ ] Write test for validate_field_schema() with valid schemas (2+ tests)
- [ ] Write test for validate_field_schema() with invalid schemas (2+ tests)
- [ ] Write test for field type validation (enum, string, number, boolean, array)
- [ ] Run tests - all fail âœ“

### Implementation (GREEN)

- [ ] Create `skills/gitstory/templates/` directory with `mkdir -p`
- [ ] Create `src/gitstory/templates/yaml_parser.py`
- [ ] Implement parse_frontmatter() function:
  ```python
  def parse_frontmatter(content: str) -> dict:
      """Parse YAML frontmatter between --- delimiters."""
      if not content.startswith('---'):
          return {}
      parts = content.split('---', 2)
      if len(parts) < 3:
          raise ValueError("Missing closing --- delimiter")
      return yaml.safe_load(parts[1])
  ```
- [ ] Implement validate_field_schema() function:
  ```python
  def validate_field_schema(field: dict) -> bool:
      """Validate field has required keys: name, type, description, required."""
      required_keys = {'name', 'type', 'description', 'required'}
      return required_keys.issubset(field.keys())
  ```
- [ ] Add error handling with line numbers for YAML syntax errors
- [ ] Add validation for field types (enum, string, number, boolean, array)
- [ ] Run tests - all pass âœ“

### BDD Implementation (Scenarios 1, 6)

- [ ] Implement step: "Given the GitStory skill directory structure"
- [ ] Implement step: "When I check skills/gitstory/templates/"
- [ ] Implement step: "Then init.md template exists for creating initiatives"
  - [ ] Check file exists (will fail until TASK-3 creates templates)
- [ ] Implement step: "Given all 6 templates"
- [ ] Implement step: "When I parse each with yaml.safe_load()"
- [ ] Implement step: "Then no parsing errors occur"
- [ ] Implement step: "And field definitions are properly structured objects"
- [ ] Run BDD tests - Scenarios 1, 6 pass (directory exists, parser works) âœ“

### Verification

- [ ] All unit tests pass (8+ tests, 100% coverage for yaml_parser.py)
- [ ] BDD Scenarios 1, 6 passing (2/6 passing)
- [ ] Directory skills/gitstory/templates/ exists
- [ ] YAML parser handles edge cases (empty, malformed, missing delimiters)

## Files to Create/Modify

- CREATE: `skills/gitstory/templates/` (directory)
- CREATE: `src/gitstory/templates/yaml_parser.py` (~80 lines, parser + validation)
- CREATE: `tests/unit/templates/test_yaml_parser.py` (~120 lines, 8+ tests)
- MODIFY: `tests/e2e/steps/test_templates.py` (implement steps for Scenarios 1, 6)

## Pattern Reuse

- `YAML frontmatter parsing with validation` (Jekyll/Hugo pattern) - Parse YAML between --- delimiters using yaml.safe_load()

## Edge Cases Handled

- Empty frontmatter (return {})
- Missing opening --- delimiter (return {})
- Missing closing --- delimiter (raise ValueError)
- Invalid YAML syntax (raise yaml.YAMLError with line number)
- Missing required field keys (return False from validation)

## Performance Targets

- YAML parsing: <10ms per template
- Field validation: <1ms per field
