# TASK-0001.1.2.2: Create CLI and Skill Directory Structure

**Parent Story**: [STORY-0001.1.2](README.md)
**Status**: ðŸ”µ Not Started
**Estimated Hours**: 8
**Actual Hours**: -

## Objective

Create directory structures for BOTH the GitStory CLI tool and Claude skill wrapper. Configure pyproject.toml with CLI dependencies and entry point. Document the CLI-skill relationship and integration pattern. Establish foundation for hybrid architecture where skill invokes CLI commands.

## Implementation Checklist

### CLI Package Structure

- [ ] Create CLI package directories:
  - [ ] `src/gitstory/cli/` (typer command modules)
  - [ ] `src/gitstory/core/` (business logic)
  - [ ] `src/gitstory/models/` (pydantic schemas)
- [ ] Create `__init__.py` in each directory
- [ ] Create CLI entry point placeholder: `src/gitstory/__main__.py`
  ```python
  # Placeholder for STORY-0001.1.3
  def main():
      print("GitStory CLI - foundation placeholder")

  if __name__ == "__main__":
      main()
  ```

### pyproject.toml Configuration

- [ ] Add CLI dependencies to `[project.dependencies]`:
  - [ ] `typer>=0.9` (CLI framework with rich integration)
  - [ ] `pydantic>=2.0` (data validation and schemas)
  - [ ] `rich>=13.0` (terminal UI, progress bars, tables)
- [ ] Add CLI entry point to `[project.scripts]`:
  ```toml
  [project.scripts]
  gitstory = "gitstory.cli:app"
  ```
- [ ] Verify PyYAML already present (added in STORY-0001.1.1)

### Skill Directory Structure

- [ ] Create skill directories:
  - [ ] `skills/gitstory/` (base directory, mode 0755)
  - [ ] `skills/gitstory/templates/` (for STORY-0001.1.5)
  - [ ] `skills/gitstory/commands/` (for STORY-0001.1.6)
  - [ ] `skills/gitstory/references/` (for STORY-0001.1.7)
  - [ ] `skills/gitstory/plugins/` (for EPIC-0001.3)
- [ ] Create placeholder files:
  - [ ] `skills/gitstory/references/.gitkeep`
  - [ ] `skills/gitstory/plugins/.gitkeep`

### README.md Documentation (500-800 words)

Create `skills/gitstory/README.md` with sections:

#### Section 1: Architecture Overview
- [ ] Explain GitStory hybrid architecture:
  - CLI tool (`src/gitstory/`) - Core business logic, installable standalone
  - Claude skill (`skills/gitstory/`) - Thin wrapper providing Claude context
- [ ] Explain skill invokes CLI commands (not direct implementation)

#### Section 2: CLI Installation & Prerequisites
- [ ] Document CLI installation methods:
  ```bash
  # Install via pipx (recommended)
  pipx install gitstory

  # Install via uvx
  uvx gitstory

  # Verify installation
  gitstory --version
  gitstory --help
  ```
- [ ] Note: Skill requires CLI to be installed first

#### Section 3: Skill-CLI Integration Pattern
- [ ] Example: How skill invokes CLI
  ```markdown
  <!-- In SKILL.md -->
  When user asks to plan a story:
  ```bash
  gitstory plan STORY-0001.2.4
  ```
  ```
- [ ] Example: How CLI loads skill resources
  ```python
  # In src/gitstory/core/template_engine.py
  def load_template(name: str) -> Template:
      # Priority: project â†’ user â†’ skill
      paths = [
          Path(".gitstory/templates/{name}"),
          Path.home() / ".claude/skills/gitstory/templates/{name}",
          Path(__file__).parent.parent.parent / "skills/gitstory/templates/{name}",
      ]
      # ...
  ```

#### Section 4: Research Findings (from TASK-0001.1.2.1)
- [ ] Document key finding: `{baseDir}` does NOT exist
- [ ] Actual pattern: `${CLAUDE_PLUGIN_ROOT}` for plugins, relative paths for skills
- [ ] Reference: `docs/research/claude-skills-path-pattern-research.md`
- [ ] Impact: Skill uses relative paths, CLI handles resolution

#### Section 5: Template/Config Lookup Priority
- [ ] Document 3-tier lookup order (implemented in CLI):
  1. Project override: `.gitstory/templates/story.md` (highest)
  2. User override: `~/.claude/skills/gitstory/templates/story.md`
  3. Skill default: `skills/gitstory/templates/story.md` (lowest)
- [ ] Note: CLI TemplateLoader/ConfigLoader implement priority logic

#### Section 6: Directory Structure
- [ ] Document CLI structure:
  - `cli/`: Typer command modules (plan, review, execute, etc.)
  - `core/`: Business logic (ticket_parser, template_engine, config_loader)
  - `models/`: Pydantic schemas (workflow, ticket, plugin)
- [ ] Document skill structure:
  - `templates/`: Default ticket templates (STORY-0001.1.5)
  - `commands/`: Command configuration YAMLs (STORY-0001.1.6)
  - `references/`: Progressive disclosure docs (STORY-0001.1.7)
  - `plugins/`: Default workflow plugins (EPIC-0001.3)

#### Section 7: Cross-Platform Compatibility
- [ ] CLI: typer/pydantic/rich handle cross-platform automatically
- [ ] Skill: relative paths work on Linux/macOS/Windows
- [ ] No symlinks required

- [ ] Target word count: 500-800 words âœ“
- [ ] Verify all required sections present âœ“

### Verification

#### CLI Structure Verification
```bash
# Verify CLI directories created
ls -la src/gitstory/cli/ src/gitstory/core/ src/gitstory/models/

# Verify __init__.py files exist
find src/gitstory -name "__init__.py"

# Verify entry point configured
grep "\[project.scripts\]" pyproject.toml
grep "gitstory =" pyproject.toml

# Verify dependencies added
grep "typer" pyproject.toml
grep "pydantic" pyproject.toml
grep "rich" pyproject.toml

# Test CLI placeholder (BEFORE STORY-0001.1.3)
python -m gitstory
# Should print: "GitStory CLI - foundation placeholder"
```

#### Skill Structure Verification
```bash
# Verify skill directories created
ls -la skills/gitstory/

# Should show: templates/, commands/, references/, plugins/, README.md

# Verify .gitkeep files tracked
git status skills/gitstory/references/.gitkeep skills/gitstory/plugins/.gitkeep

# Verify no symlinks
find skills/gitstory -type l  # Should return empty
```

#### README.md Verification
- [ ] README.md renders correctly in markdown preview
- [ ] Word count within 500-800 range
- [ ] All sections present and complete
- [ ] Code examples accurate and tested

## Files to Create/Modify

### CLI Files
- **CREATE**: `src/gitstory/cli/` (directory)
- **CREATE**: `src/gitstory/cli/__init__.py` (empty)
- **CREATE**: `src/gitstory/core/` (directory)
- **CREATE**: `src/gitstory/core/__init__.py` (empty)
- **CREATE**: `src/gitstory/models/` (directory)
- **CREATE**: `src/gitstory/models/__init__.py` (empty)
- **CREATE**: `src/gitstory/__main__.py` (~10 lines, placeholder)
- **MODIFY**: `pyproject.toml` (add dependencies + entry point)

### Skill Files
- **CREATE**: `skills/gitstory/` (directory, mode 0755)
- **CREATE**: `skills/gitstory/README.md` (~600 lines, architecture documentation)
- **CREATE**: `skills/gitstory/templates/` (directory, mode 0755)
- **CREATE**: `skills/gitstory/commands/` (directory, mode 0755)
- **CREATE**: `skills/gitstory/references/` (directory, mode 0755)
- **CREATE**: `skills/gitstory/references/.gitkeep` (empty placeholder)
- **CREATE**: `skills/gitstory/plugins/` (directory, mode 0755)
- **CREATE**: `skills/gitstory/plugins/.gitkeep` (empty placeholder)

## Pattern Reuse

None - This is foundational infrastructure creation with no existing patterns to reuse.

## Dependencies

- TASK-0001.1.2.1 complete (research findings documented)
- Git repository initialized
- Python project bootstrapped (STORY-0001.1.1)
- src/gitstory/ package exists

## Edge Cases & Error Handling

- **Directories already exist**: Verify structure matches spec, skip creation if correct
- **Parent directories missing**: Create parent first (e.g., `mkdir -p`)
- **Permission denied**: Fail with clear error showing which directory failed
- **pyproject.toml syntax**: Validate TOML after changes with `uv sync`
- **Entry point broken**: Test with `python -m gitstory` after creation

## Notes

This task creates the physical foundation for both CLI and skill. All subsequent stories depend on this structure.

**CLI Placeholder**: `__main__.py` prints message only. Actual CLI implementation happens in STORY-0001.1.3.

**Testing strategy**: Manual verification only (per TESTING.md - infrastructure work).

**Success criteria**: Both structures created, pyproject.toml configured, README.md comprehensive (500-800 words), all verification steps pass.
